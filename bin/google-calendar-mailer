#!/usr/bin/env node
const gcm = require('../lib/google-calendar-mailer')

let cronMode = (process.argv[2] === '-c')
let taskFile = process.argv[cronMode ? 3 : 2]

if (!taskFile) {
  gcm.errorExitWithMessage(`
    Usage: google-calendar-mailer <taskfile>
           google-calendar-mailer -c <taskfile>

           -c: cron mode
               disables interactive access token setup
               exit code of 1 if access token is missing or invalid
  `)
}

taskFile = require('path').resolve(process.cwd(), taskFile)
try {
  taskFile = require(taskFile)
} catch (e) {
  gcm.errorExitWithMessage(`Unable to find or parse file: ${taskFile}`)
}

try {
  gcm.initialize(taskFile.settings, taskFile.tasks, cronMode)
} catch (e) {
  gcm.errorExitWithMessage(`Unable to process configuration: ${e.message}`)
}
