#!/usr/bin/env node

var calendarManager = require('../lib/calendarManager');
var path = require('path');
var nodeMailer = require('nodemailer');

var taskFile = process.argv[2];

if (!taskFile) {
  console.log('Usage: google-calendar-mailer <taskFile>');
  console.log('See README.md for more information.');
  process.exit(1);
}

var taskFunction;
taskFile = path.resolve(process.cwd(), taskFile);
try {
  taskFunction = require(taskFile);
} catch (e) {
  console.log('Error: Unable to find file: ' + taskFile);
  process.exit(1);
}

var manager = calendarManager();
try {
  taskFunction({
    api: manager.setCredentials,
    task: manager.addTask
  }, nodeMailer);
} catch (e) {
  console.log('Error: Unable to process configuration: ' + e);
  process.exit(1);
}

manager.authorized(manager.runTasks, manager.getNewToken);
