#!/usr/bin/env node

var CalendarMailer = require('../lib/CalendarMailer');
var path = require('path');

var setupMode = (process.argv[2] === '--setup' || process.argv[2] === '--s');
var taskFile = setupMode ? process.argv[3] : process.argv[2];

if (!taskFile) {
  console.log('See README.md for more information. Usage: ');
  console.log('  google-calendar-mailer <taskFile>');
  console.log('or');
  console.log('  google-calendar-mailer --setup <taskFile>');
  process.exit(1);
}

var config;
taskFile = path.resolve(__dirname, '..', taskFile);
try {
  config = require(taskFile);
} catch (e) {
  console.log('Error: Unable to find file ' + taskFile);
  process.exit(1);
}

var calendarMailer;
try {
  calendarMailer = new CalendarMailer(config);
} catch (e) {
  console.log('Error: Unable to process configuration');
  process.exit(1);
}

if (setupMode) {
  calendarMailer.setup();
} else {
  console.log('Running Tasks: ');
  calendarMailer.runTasks();
}
